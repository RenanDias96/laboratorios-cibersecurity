# ğŸ› AnÃ¡lise de Malware via PCAP: Botnet IRC + SSH

ğŸ“… **Data da anÃ¡lise:** 02/06/2025  
ğŸ“„ Documento criado por **Renan D M** 
ğŸ’¡ Estudo prÃ¡tico com Wireshark a partir de um trÃ¡fego capturado (.pcap), identificando atividade maliciosa tÃ­pica de botnet com C2 via IRC e persistÃªncia por SSH.

---

## ğŸ§© Etapa 0 â€“ Fonte do Arquivo PCAP

- Fonte do PCAP:  
  [Stratosphere IoT Dataset](https://www.stratosphereips.org/datasets-iot)  
- CenÃ¡rio e captura especÃ­fica:  
  [CTU-IoT-Malware-Capture-34-1](https://mcfp.felk.cvut.cz/publicDatasets/IoTDatasets/CTU-IoT-Malware-Capture-34-1/)

![Download do PCAP - site](prints/1.png)  
![ConfirmaÃ§Ã£o do arquivo capturado](prints/2.png)

---

## ğŸ” Etapa 1 â€“ IdentificaÃ§Ã£o Inicial dos Protocolos

Ao abrir o `.pcap`, jÃ¡ notamos trÃ¡fego SSH e TCP suspeito, com volume anormal de conexÃµes.

![Abertura do .pcap com Wireshark](prints/3.png)

---

## ğŸ“Š Etapa 2 â€“ AnÃ¡lise da Hierarquia de Protocolos

AnÃ¡lise da hierarquia mostra alto volume de trÃ¡fego, com destaque para SSH e IRC.

![Hierarquia de protocolos](prints/4.png)

---

## ğŸ§° Etapa 3 â€“ Filtros TCP e IP Suspeito

Foi adicionada a coluna `tcp.port` e aplicado o filtro `ip.addr == 192.168.1.195` para analisar o host suspeito.

![Filtro aplicado ao IP 192.168.1.195](prints/5.png)

---

## ğŸ§  Etapa 4 â€“ IndÃ­cio de Acesso via Script Malicioso

Identificado trÃ¡fego na porta alta `40831`. â€œFollow TCP Streamâ€ revelou um possÃ­vel payload.

![Script malicioso via TCP Stream](prints/6.png)

---

## ğŸŒ Etapa 5 â€“ Rastreio de IPs Envolvidos

Identificado o IP externo `185.244.25.235` comunicando com o host interno.

![ComunicaÃ§Ã£o com IP externo](prints/7.png)

---

## ğŸ›°ï¸ Etapa 6 â€“ ConfirmaÃ§Ã£o do Envio de Malware

Host interno realiza download direto via HTTP do C2.

![Download iniciado](prints/8.png)  
![Resposta HTTP com conteÃºdo](prints/9.png)

---

## ğŸ§© Etapa 7 â€“ IdentificaÃ§Ã£o do Payload Fragmentado

Fragmentos de payload identificados com filtro `http.response`.

![Fragmentos de payload](prints/10.png)

---

## ğŸ“¦ Etapa 8 â€“ ExportaÃ§Ã£o dos Arquivos HTTP

Arquivos transferidos foram exportados para anÃ¡lise.

![ExportaÃ§Ã£o de arquivos HTTP](prints/11.png)

---

## ğŸ’¬ Etapa 9 â€“ ComunicaÃ§Ã£o via IRC (C2)

Host infectado se comunica com `irc.summit.gov.GoV`. Comandos de bot visÃ­veis via TCP stream.

![ComunicaÃ§Ã£o por IRC detectada](prints/12.png)  
![Comandos no Follow TCP Stream](prints/13.png)

---

## ğŸ”’ Etapa 10 â€“ PersistÃªncia via SSH em Porta Alta

ConexÃ£o ativa detectada via SSH na porta `40831`.

![ConexÃ£o SSH persistente](prints/14.png)

---

## ğŸ§¾ ConsideraÃ§Ãµes Finais

Host `192.168.1.195` realizou downloads de arquivos maliciosos a partir de `185.244.25.235`, instalou bot, iniciou C2 por IRC e estabeleceu persistÃªncia via SSH em porta alta.

![Comandos do botnet e comunicaÃ§Ã£o](prints/15.png)

O malware realiza reconhecimento da arquitetura do sistema, mantÃ©m comunicaÃ§Ã£o via heartbeats com o servidor e responde a comandos como `!tcp`, `!xmas`, `!spoof`, entre outros.

AnÃ¡lise de DNS confirma que nÃ£o houve redirecionamento â€” o download foi direto pela URL do servidor.

![VerificaÃ§Ã£o de DNS](prints/16.png)

---

## ğŸ•µï¸â€â™‚ï¸ TÃ©cnicas Utilizadas

- **Download de Payload via HTTP**
- **C2 via IRC fora da porta padrÃ£o**
- **PersistÃªncia SSH por porta alta (40831)**
- **Floods, spoofing e nicknames automatizados**
- **EvasÃ£o de IDS/IPS com portas incomuns e heartbeats**

---

## ğŸ“‰ Indicadores de Comprometimento (IOCs)

| Tipo              | Valor                                        |
|-------------------|----------------------------------------------|
| IP C2 externo     | `185.244.25.235`                             |
| DomÃ­nio malicioso | `irc.summit.gov.GoV`                         |
| IP interno        | `192.168.1.195`                              |
| Portas            | `40831` (SSH), `6667`, `80`                  |
| Comandos vistos   | `!tcp`, `!xmas`, `!spoof`, `!nick`, `!flood` |
| URLs acessadas    | `.bin` via exportaÃ§Ã£o HTTP                   |

---

## ğŸ›¡ï¸ Medidas de MitigaÃ§Ã£o

- Regras IDS/IPS para:
  - IRC fora da 6667
  - SSH em portas nÃ£o padrÃ£o
  - ConexÃµes massivas e persistentes por IP
- Bloqueio de IPs/domÃ­nios maliciosos
- Proxy com inspeÃ§Ã£o de pacotes HTTP
- SegmentaÃ§Ã£o de rede para IoT
- Hardening e auditoria de dispositivos
- IntegraÃ§Ã£o de logs com SIEM

---

