# Análise de Malware via PCAP: Botnet IRC + SSH

**Data da análise:** 02/06/2025  
Autor: **Renan D M** 

Estudo com Wireshark a partir de um tráfego capturado (.pcap), identificando atividade típica de botnet com C2 via IRC e persistência por SSH.

---

## 1 – Fonte do Arquivo PCAP

- Fonte do PCAP:  
  [Stratosphere IoT Dataset](https://www.stratosphereips.org/datasets-iot)  
- Cenário e captura específica:  
  [CTU-IoT-Malware-Capture-34-1](https://mcfp.felk.cvut.cz/publicDatasets/IoTDatasets/CTU-IoT-Malware-Capture-34-1/)

![Download do PCAP - site](prints/1.png)  
![Confirmação do arquivo capturado](prints/2.png)

---

## 2 – Identificação Inicial dos Protocolos

- Ao abrir o `.pcap`, já notamos tráfego SSH e TCP suspeito, com volume anormal de conexões.

![Abertura do .pcap com Wireshark](prints/3.png)

---

## 3 – Análise da Hierarquia de Protocolos

- Análise da hierarquia mostra alto volume de tráfego, com destaque para SSH e IRC.

![Hierarquia de protocolos](prints/4.png)

---

## 4 – Filtros TCP e IP Suspeito

- Foi adicionada a coluna `tcp.port` e aplicado o filtro `ip.addr == 192.168.1.195` para analisar o host suspeito.

![Filtro aplicado ao IP 192.168.1.195](prints/5.png)

---

## 5 – Indício de Acesso via Script Malicioso

- Identificado tráfego na porta alta `40831`. “Follow TCP Stream” revelou um possível payload.

![Script malicioso via TCP Stream](prints/6.png)

---

## 6 – Rastreio de IPs Envolvidos

- Identificado o IP externo `185.244.25.235` comunicando com o host interno.

![Comunicação com IP externo](prints/7.png)

---

## 7 – Confirmação do Envio de Malware

- Host interno realiza download direto via HTTP do C2.

![Download iniciado](prints/8.png)  
![Resposta HTTP com conteúdo](prints/9.png)

---

## 8 – Identificação do Payload Fragmentado

- Fragmentos de payload identificados com filtro `http.response`.

![Fragmentos de payload](prints/10.png)

---

## 9 – Exportação dos Arquivos HTTP

- Arquivos transferidos foram exportados para análise.

![Exportação de arquivos HTTP](prints/11.png)

---

## 10 – Comunicação via IRC (C2)

- Host infectado se comunica com `irc.summit.gov.GoV`. Comandos de bot visíveis via TCP stream.

![Comunicação por IRC detectada](prints/12.png)  
![Comandos no Follow TCP Stream](prints/13.png)

---

## 11 – Persistência via SSH em Porta Alta

- Conexão ativa detectada via SSH na porta `40831`.

![Conexão SSH persistente](prints/14.png)

---

## Considerações Finais

- Host `192.168.1.195` realizou downloads de arquivos infectados a partir de `185.244.25.235`, instalou bot, iniciou C2 por IRC e estabeleceu persistência via SSH em porta alta.

![Comandos do botnet e comunicação](prints/15.png)

- O malware realiza reconhecimento da arquitetura do sistema, mantém comunicação via heartbeats com o servidor e responde a comandos como `!tcp`, `!xmas`, `!spoof`, entre outros.

- A análise de DNS confirma que não houve redirecionamento — o download foi direto pela URL do servidor.

![Verificação de DNS](prints/16.png)

---

## Indicadores de Comprometimento (IOCs)

| Tipo              | Valor                                        |
|-------------------|----------------------------------------------|
| IP C2 externo     | `185.244.25.235`                             |
| Domínio malicioso | `irc.summit.gov.GoV`                         |
| IP interno        | `192.168.1.195`                              |
| Portas            | `40831` (SSH), `6667`, `80`                  |
| Comandos vistos   | `!tcp`, `!xmas`, `!spoof`, `!nick`, `!flood` |
| URLs acessadas    | `.bin` via exportação HTTP                   |

---
